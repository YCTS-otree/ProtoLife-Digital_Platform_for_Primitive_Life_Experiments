# 世界设置：尺寸、可选地图、资源密度、随机种子
world:
  height: 64  # 地图高度
  width: 64   # 地图宽度
  map_file: "maps/t_64.hex"  # 自定义地图文件路径，null 表示随机生成
  food_density: 0.08  # 初始食物密度
  toxin_density: 0.05  # 初始毒素密度
  food_respawn_interval: 256  # 每隔多少步重新撒一次食物，0 表示关闭
  toxin_respawn_interval: 256  # 每隔多少步重新撒一次毒素，0 表示关闭
  toxin_lifetime: 257   # 毒素存续步数，超过后自动衰减
  random_seed: 42  # 随机种子，方便复现
  resource_noise:  # 使用 Perlin Noise 生成更平滑的资源分布，可关闭回退到均匀随机
    enabled: true
    scale: 8.0       # 控制噪声纹理尺寸，值越大区域越大
    octaves: 2        # 叠加的噪声层数，提升复杂度
    persistence: 0.5  # 每层振幅衰减系数
    lacunarity: 2.0   # 频率倍增系数
    seed: null        # 噪声随机种子，null 表示使用 random_seed 或随机生成
    food_bias: 0.1   # 对食物分布的额外偏移，可正可负
    toxin_bias: -0.1 # 对毒物分布的额外偏移，可正可负

# 模型结构参数
model:
  observation_radius: 3  # 每个体可见半径 r
  use_cnn: true  # 是否使用 CNN+RNN 结构（默认开启，关闭时回退到简单 MLP）
  cnn_channels: [32, 64]  # 卷积层通道数列表，可按需加深
  cnn_feature_dim: 256  # 卷积输出展平后的线性投影维度
  rnn_hidden_dim: 128  # GRU/LSTM 隐状态维度（同时也是 Agent 记忆张量维度）
  rnn_type: gru  # gru 或 lstm，决定短期记忆类型
  hidden: 16384  # MLP 回退模式下的隐藏层宽度

# 个体初始与代谢参数
agents:
  per_env: 4  # 每个环境中的个体数
  base_energy: 50  # 初始能量
  energy_max: 100  # 能量上限
  base_health: 100  # 初始健康
  health_max: 100  # 健康上限
  base_metabolism_cost: 0.1  # 每步基础代谢消耗
  move_cost: 0.1  # 移动额外能量消耗
  communication_cost: 0.1  # 通信能量消耗（预留）
  reproduction_energy_threshold: 80  # 繁衍能量阈值
  child_energy_fraction: 0.3  # 子代获得的亲代能量比例
  reproduction_health_cost: 5.0  # 成功繁衍后父代扣除的健康值

# 通信/战斗参数
communication:
  radius: 2  # 信号作用半径
  base_strength: 1.0  # 信号初始强度，对数衰减

combat:
  damage: 10.0  # 基础伤害
  radius: 2.0   # 伤害半径
  decay: log    # 衰减模式：false/none、log、linear

reproduction:
  health_cost: 5.0  # 繁衍成功后父代扣除的健康值

# 训练超参与调试开关
training:
  num_envs: 1  # 并行环境数量
  rollout_steps: 65536  # 单次收集的步数
  gamma: 0.99  # 折扣因子
  gae_lambda: 0.95  # GAE 参数
  ppo_clip: 0.2  # PPO clip 系数（预留）
  entropy_coef: 0.01  # 策略熵权重，防止动作过早塌缩，设置为 0 可关闭
  action_noise:  # 行动时额外注入的噪声配置
    gaussian_std: 0.001  # 对 logits 添加的高斯噪声标准差
    epsilon: 0.001  # 以 epsilon 概率使用均匀随机动作（epsilon-greedy）
  save_interval: 4096  # 模型/存档保存间隔
  checkpoint_dir: K:/Proto_Digital_Life/checkpoints  # checkpoint 输出目录
  print_actions: false  # 是否打印每步动作，便于调试
  print_interval: 64  # 进度打印间隔（步数）

# 功能开关
features:
  use_reproduction: true  # 是否启用繁衍机制
  use_combat: true  # 是否启用战斗
  use_communication: true  # 是否启用通信
  use_terraforming: true  # 是否启用环境改造

# 日志与可视化设置
logging:
  snapshot_interval: 16  # 记录快照的步间隔
  realtime_render: true  # 是否开启实时渲染
  save_dir: runs/default  # 日志目录
  env_index: 0  # 多环境时选择写入第几个环境的快照
  agent_marker_size: 20  # 实时/回放中个体散点尺寸（matplotlib scatter 的 s）
  snapshot_gpu_stage: true  # 是否先将快照留在 GPU，批量写回 CPU
  snapshot_flush_interval: 8  # GPU 暂存的快照数量，达到后批量写回
  show_step: true  # 实时渲染时是否展示 step 计数

# 动作基础奖励表
action_rewards:
  STAY: -0.02
  MOVE: 0.02
  EAT: 0.01
  ATTACK: 0.02
  COMMUNICATE: 0.03
  BUILD: 0.02
  REMOVE: 0.02
  REPRODUCE: 0.05

# 动作能量消耗表
action_energy_costs:
  STAY: 0.0
  MOVE: 0.05
  EAT: 0.02
  ATTACK: 0.5
  COMMUNICATE: 0.2
  BUILD: 0.3
  REMOVE: 0.2
  REPRODUCE: 1.0

# 额外奖励/惩罚系数
rewards:
  survival_reward: 0.001  # 每步活着获得的奖励
  food_reward: 0.5        # 成功吃到食物奖励
  food_energy: 10.0       # 吃到食物补充的能量
  toxin_penalty: -0.5     # 站在毒物格子的惩罚
  toxin_health: -2.0      # 毒物对健康扣减
  failed_eat_penalty: -0.005  # 使用 EAT 但当前格没有食物的惩罚
  toxin_eat_penalty: -0.4    # 在毒物格执行 EAT 额外惩罚
  enable_proximity_reward: true  # 是否启用视野内食物距离奖励
  see_food_reward: 0.001          # 视野中发现食物的基础奖励（距离衰减前）
  stand_on_food_reward: 0.03      # 踩在食物格上的基础奖励
  vision_decay_mode: log       # 距离衰减模式：linear 或 log
  vision_decay_coefficient: 1.0   # 距离衰减系数（随距离增大奖励降低）
  energy_fit_threshold: 50.0      # 能量奖励的拐点能量值
  energy_reward_at_fit: 0.05      # 能量处于拐点时的奖励
  energy_reward_at_extreme: -0.05  # 能量达到极端（0 或最大）时的奖励
  energy_reward_mode: linear      # 能量奖励曲线模式：linear/log/invlog
  energy_reward_coefficient: 1.0  # 能量奖励曲线系数
  health_reward_at_max: 0.05      # 健康达到最大值时的奖励
  health_reward_at_zero: -0.2     # 健康为 0 时的奖励
  health_reward_mode: linear      # 健康奖励曲线模式：linear/log/invlog
  health_reward_coefficient: 1.0  # 健康奖励曲线系数
  health_recovery_energy_threshold: 40.0  # 高于该能量时按固定值恢复健康
  health_recovery_per_step: 0.5            # 健康每步恢复量
  health_decay_min: -1.0                   # 能量为 0 时健康衰减的最小值（负数）
  health_decay_mode: linear                # 低能量健康衰减曲线模式：linear/log/invlog
  health_decay_coefficient: 1.0            # 低能量健康衰减曲线系数
